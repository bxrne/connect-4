// generated by info.scce.dime.generator.rest.SelectiveControllerGenerator
package de.ls5.dywa.generated.rest.controller;

@javax.transaction.Transactional
@javax.enterprise.context.RequestScoped
public class GameREST {

	@javax.inject.Inject
	private info.scce.dime.rest.ObjectCache objectCache;
	@javax.inject.Inject
	private de.ls5.dywa.generated.util.DomainFileController DomainFileController;
	
	
	@javax.inject.Inject
	private de.ls5.dywa.generated.rest.controller.GameREST GameREST;
	@javax.inject.Inject
	private de.ls5.dywa.generated.controller.models.app.GameController GameController;
	@javax.inject.Inject
	private de.ls5.dywa.generated.rest.controller.ConcreteUserREST ConcreteUserREST;
	@javax.inject.Inject
	private de.ls5.dywa.generated.controller.models.app.ConcreteUserController ConcreteUserController;
	@javax.inject.Inject
	private de.ls5.dywa.generated.rest.controller.BoardREST BoardREST;
	@javax.inject.Inject
	private de.ls5.dywa.generated.controller.models.app.BoardController BoardController;

	public long create(final java.lang.String name) {
		final de.ls5.dywa.generated.entity.models.app.Game obj = this.GameController.create(name);
		return obj.getDywaId();
	}

	



	public void update_GameSelective(final de.ls5.dywa.generated.rest.types.Game value) {

		final de.ls5.dywa.generated.entity.models.app.Game obj = this.GameController.read(value.getDywaId());
		
		this.update_GameSelective(value, obj);
	}

	public void update_GameSelective(final de.ls5.dywa.generated.rest.types.Game value, final de.ls5.dywa.generated.entity.models.app.Game obj) {

		// for updates, consider a special selective so we don't clash with read-operations
		if (this.objectCache.containsSelective(obj, "GameSelective")) {
			// We are already getting updated by someone else
			return;
		}
		else {
			// we don't care for the actual value. key alone is sufficient enough for detection of cycles
			this.objectCache.putSelective(obj, "GameSelective");
		}

		if (value.isDywaNameSet()) {
			obj.setDywaName(value.getDywaName());
		}

		{
			final de.ls5.dywa.generated.rest.types.Game effectiveValue = value;
			final de.ls5.dywa.generated.entity.models.app.Game effectiveObj = obj;

		// If values were not specified, ignore them
		if (effectiveValue.isplayer2Set()) {
			checkVersion(value, obj);
			if (effectiveValue.getplayer2() == null) {
				effectiveObj.setplayer2(null);
			}
			else {
				final de.ls5.dywa.generated.entity.models.app.ConcreteUser
				 entity;
				final de.ls5.dywa.generated.rest.types.ConcreteUser
				 item = effectiveValue.getplayer2();
			
				// create new
				if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_CREATE_NEW) {
					if (! (item instanceof de.ls5.dywa.generated.rest.types.ConcreteUser)) {
						throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
					}
				
					final java.lang.String dywaName;
					if (item.getDywaName() == null || item.getDywaName().isEmpty()) {
						dywaName = "player2";
					} else {
						dywaName = item.getDywaName();
					}
				
					final long id = ConcreteUserREST.create(dywaName);
					item.setDywaId(id);
				
					//update_ConcreteUserSelective
					this.ConcreteUserREST.update_ConcreteUserSelective(item);
					entity = this.ConcreteUserController.read(item.getDywaId());
				}
				// create transient
				else if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_TRANSIENT) {
					if (! (item instanceof de.ls5.dywa.generated.rest.types.ConcreteUser)) {
						throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
					}
				
					entity = this.ConcreteUserREST.copyToTransient(item);
				}
				// lookup regular object
				else {
					//update_ConcreteUserSelective
					this.ConcreteUserREST.update_ConcreteUserSelective(item);
					entity = this.ConcreteUserController.read(item.getDywaId());
				}
			
				effectiveObj.setplayer2(entity);
			
			}
		}
	}
		{
			final de.ls5.dywa.generated.rest.types.Game effectiveValue = value;
			final de.ls5.dywa.generated.entity.models.app.Game effectiveObj = obj;

		// If values were not specified, ignore them
		if (effectiveValue.isplayer1Set()) {
			checkVersion(value, obj);
			if (effectiveValue.getplayer1() == null) {
				effectiveObj.setplayer1(null);
			}
			else {
				final de.ls5.dywa.generated.entity.models.app.ConcreteUser
				 entity;
				final de.ls5.dywa.generated.rest.types.ConcreteUser
				 item = effectiveValue.getplayer1();
			
				// create new
				if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_CREATE_NEW) {
					if (! (item instanceof de.ls5.dywa.generated.rest.types.ConcreteUser)) {
						throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
					}
				
					final java.lang.String dywaName;
					if (item.getDywaName() == null || item.getDywaName().isEmpty()) {
						dywaName = "player1";
					} else {
						dywaName = item.getDywaName();
					}
				
					final long id = ConcreteUserREST.create(dywaName);
					item.setDywaId(id);
				
					//update_ConcreteUserSelective
					this.ConcreteUserREST.update_ConcreteUserSelective(item);
					entity = this.ConcreteUserController.read(item.getDywaId());
				}
				// create transient
				else if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_TRANSIENT) {
					if (! (item instanceof de.ls5.dywa.generated.rest.types.ConcreteUser)) {
						throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
					}
				
					entity = this.ConcreteUserREST.copyToTransient(item);
				}
				// lookup regular object
				else {
					//update_ConcreteUserSelective
					this.ConcreteUserREST.update_ConcreteUserSelective(item);
					entity = this.ConcreteUserController.read(item.getDywaId());
				}
			
				effectiveObj.setplayer1(entity);
			
			}
		}
	}
		{
			final de.ls5.dywa.generated.rest.types.Game effectiveValue = value;
			final de.ls5.dywa.generated.entity.models.app.Game effectiveObj = obj;

		// If values were not specified, ignore them
		if (effectiveValue.isboardSet()) {
			checkVersion(value, obj);
			if (effectiveValue.getboard() == null) {
				effectiveObj.setboard(null);
			}
			else {
				final de.ls5.dywa.generated.entity.models.app.Board
				 entity;
				final de.ls5.dywa.generated.rest.types.Board
				 item = effectiveValue.getboard();
			
				// create new
				if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_CREATE_NEW) {
					if (! (item instanceof de.ls5.dywa.generated.rest.types.Board)) {
						throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
					}
				
					final java.lang.String dywaName;
					if (item.getDywaName() == null || item.getDywaName().isEmpty()) {
						dywaName = "board";
					} else {
						dywaName = item.getDywaName();
					}
				
					final long id = BoardREST.create(dywaName);
					item.setDywaId(id);
				
					//update_BoardSelective
					this.BoardREST.update_BoardSelective(item);
					entity = this.BoardController.read(item.getDywaId());
				}
				// create transient
				else if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_TRANSIENT) {
					if (! (item instanceof de.ls5.dywa.generated.rest.types.Board)) {
						throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
					}
				
					entity = this.BoardREST.copyToTransient(item);
				}
				// lookup regular object
				else {
					//update_BoardSelective
					this.BoardREST.update_BoardSelective(item);
					entity = this.BoardController.read(item.getDywaId());
				}
			
				effectiveObj.setboard(entity);
			
			}
		}
	}
	}

	public de.ls5.dywa.generated.entity.models.app.Game copyToTransient(final de.ls5.dywa.generated.rest.types.Game value) {

		final de.ls5.dywa.generated.entity.models.app.Game obj;

		if (this.objectCache.containsTransient(value)) {
			return this.objectCache.getTransient(value);
		}
		else {
			final java.lang.String name;
			if (value.getDywaName() == null || value.getDywaName().isEmpty()) {
				name = "Game_transient";
			} else {
				name = value.getDywaName();
			}
			obj = GameController.createTransient(name);
			this.objectCache.putTransient(value, obj);
		}

		if (value.isDywaNameSet()) {
			obj.setDywaName(value.getDywaName());
		}

			{
				final de.ls5.dywa.generated.rest.types.Game effectiveValue = value;
				final de.ls5.dywa.generated.entity.models.app.Game effectiveObj = obj;

			// If values were not specified, ignore them
			if (effectiveValue.isplayer2Set()) {
				checkVersion(value, obj);
				if (effectiveValue.getplayer2() == null) {
					effectiveObj.setplayer2(null);
				}
				else {
					final de.ls5.dywa.generated.entity.models.app.ConcreteUser
					 entity;
					final de.ls5.dywa.generated.rest.types.ConcreteUser
					 item = effectiveValue.getplayer2();
				
					// create new
					if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_CREATE_NEW) {
						if (! (item instanceof de.ls5.dywa.generated.rest.types.ConcreteUser)) {
							throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
						}
					
						final java.lang.String dywaName;
						if (item.getDywaName() == null || item.getDywaName().isEmpty()) {
							dywaName = "player2";
						} else {
							dywaName = item.getDywaName();
						}
					
						final long id = ConcreteUserREST.create(dywaName);
						item.setDywaId(id);
					
						//update_ConcreteUserSelective
						this.ConcreteUserREST.update_ConcreteUserSelective(item);
						entity = this.ConcreteUserController.read(item.getDywaId());
					}
					// create transient
					else if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_TRANSIENT) {
						if (! (item instanceof de.ls5.dywa.generated.rest.types.ConcreteUser)) {
							throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
						}
					
						entity = this.ConcreteUserREST.copyToTransient(item);
					}
					// lookup regular object
					else {
						//update_ConcreteUserSelective
						this.ConcreteUserREST.update_ConcreteUserSelective(item);
						entity = this.ConcreteUserController.read(item.getDywaId());
					}
				
					effectiveObj.setplayer2(entity);
				
				}
			}
		}
			{
				final de.ls5.dywa.generated.rest.types.Game effectiveValue = value;
				final de.ls5.dywa.generated.entity.models.app.Game effectiveObj = obj;

			// If values were not specified, ignore them
			if (effectiveValue.isplayer1Set()) {
				checkVersion(value, obj);
				if (effectiveValue.getplayer1() == null) {
					effectiveObj.setplayer1(null);
				}
				else {
					final de.ls5.dywa.generated.entity.models.app.ConcreteUser
					 entity;
					final de.ls5.dywa.generated.rest.types.ConcreteUser
					 item = effectiveValue.getplayer1();
				
					// create new
					if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_CREATE_NEW) {
						if (! (item instanceof de.ls5.dywa.generated.rest.types.ConcreteUser)) {
							throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
						}
					
						final java.lang.String dywaName;
						if (item.getDywaName() == null || item.getDywaName().isEmpty()) {
							dywaName = "player1";
						} else {
							dywaName = item.getDywaName();
						}
					
						final long id = ConcreteUserREST.create(dywaName);
						item.setDywaId(id);
					
						//update_ConcreteUserSelective
						this.ConcreteUserREST.update_ConcreteUserSelective(item);
						entity = this.ConcreteUserController.read(item.getDywaId());
					}
					// create transient
					else if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_TRANSIENT) {
						if (! (item instanceof de.ls5.dywa.generated.rest.types.ConcreteUser)) {
							throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
						}
					
						entity = this.ConcreteUserREST.copyToTransient(item);
					}
					// lookup regular object
					else {
						//update_ConcreteUserSelective
						this.ConcreteUserREST.update_ConcreteUserSelective(item);
						entity = this.ConcreteUserController.read(item.getDywaId());
					}
				
					effectiveObj.setplayer1(entity);
				
				}
			}
		}
			{
				final de.ls5.dywa.generated.rest.types.Game effectiveValue = value;
				final de.ls5.dywa.generated.entity.models.app.Game effectiveObj = obj;

			// If values were not specified, ignore them
			if (effectiveValue.isboardSet()) {
				checkVersion(value, obj);
				if (effectiveValue.getboard() == null) {
					effectiveObj.setboard(null);
				}
				else {
					final de.ls5.dywa.generated.entity.models.app.Board
					 entity;
					final de.ls5.dywa.generated.rest.types.Board
					 item = effectiveValue.getboard();
				
					// create new
					if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_CREATE_NEW) {
						if (! (item instanceof de.ls5.dywa.generated.rest.types.Board)) {
							throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
						}
					
						final java.lang.String dywaName;
						if (item.getDywaName() == null || item.getDywaName().isEmpty()) {
							dywaName = "board";
						} else {
							dywaName = item.getDywaName();
						}
					
						final long id = BoardREST.create(dywaName);
						item.setDywaId(id);
					
						//update_BoardSelective
						this.BoardREST.update_BoardSelective(item);
						entity = this.BoardController.read(item.getDywaId());
					}
					// create transient
					else if (item.getDywaId() == info.scce.dime.util.Constants.DYWA_ID_TRANSIENT) {
						if (! (item instanceof de.ls5.dywa.generated.rest.types.Board)) {
							throw new java.lang.IllegalArgumentException("Runtime type does not match model type");
						}
					
						entity = this.BoardREST.copyToTransient(item);
					}
					// lookup regular object
					else {
						//update_BoardSelective
						this.BoardREST.update_BoardSelective(item);
						entity = this.BoardController.read(item.getDywaId());
					}
				
					effectiveObj.setboard(entity);
				
				}
			}
		}

		return obj;
	}

	public void delete(final long id) {
		final de.ls5.dywa.generated.entity.models.app.Game obj = this.GameController.read(id);
		this.GameController.delete(obj);
	}

	private void checkVersion(final de.ls5.dywa.generated.rest.types.Game value, final de.ls5.dywa.generated.entity.models.app.Game obj) {
		if (value.isDywaVersionSet() && value.getDywaVersion() != obj.getDywaVersion()) {
			throw new javax.persistence.OptimisticLockException(obj.getDywaName() + '[' + obj.getDywaId() + "] has been updated by other transaction");
		}
	}
}
